// user_id get from Authentification-Authorization external service
// шардирование по user_id. 1024 virtual buckets
// репликация master- 1 slave sync - 2 slaves async для каждого шарда

Table posts {
  id bigint [primary key]
  title nvarchar
  content text
  user_id uuid
  tags uuid[]
  status posts_status
  created_at timestamp
  modifier_id uuid
  modified_at timestamp
}

enum posts_status {
  created
  published
  hidden
}

Table tags {
  id uuid
  value nvarchar
}

Table post_comments {
  id bigint [primary key]
  parent_id bigint [null]
  post_id bigint
  user_id uuid
  text text
  created_at timestamp
  modified_at timestamp
  likes int
  dislikes int
}

Table chats {
  id uuid [primary key]
  title nvarchar
  description text
}

Table chats_to_users {
  chat_id uuid
  user_id uuid
}

Table messages {
  id bigint [primary key]
  from uuid
  to uuid
  chat_id uuid [null]
  type channel
  created_at timestamp
  delivered bit
  delivered_at timestamp
}

enum channel {
  user
  chat
}

// Ref: posts.user_id > user_id // many-to-one
// Ref: posts.modifier_id > user_id // many-to-one
// Ref: redis.dbml:post_stats.post_id - posts.id // one-to-one
// Ref: post_comments.id < post_comments.id // one-to-many
// Ref: post_comments.post_id > posts.id // many-to-one
// Ref: post_comments.user_id > user_id // many-to-one
// Ref: user_id < messages.from // one-to-many
// Ref: user_id < messages.to // one-to-many
// Ref: chats.id < messages.chat_id // one-to-many
// Ref: chats_to_users.chat_id > chats.id // many-to-one
// Ref: chats_to_users.user_id > user_id // many-to-one